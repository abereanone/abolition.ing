---
import { formatQuestionIdentifier } from "@/lib/questions";
import { siteSettings } from "@/config/siteSettings";

const { questions, startIndex = 0 } = Astro.props;
const showQuestionId = siteSettings.showQuestionId;
const baseIndex =
  typeof startIndex === "number" && Number.isFinite(startIndex) ? Math.max(0, Math.floor(startIndex)) : 0;
---
<ul class="question-list">
  {questions.map((q, index) => {
    const fallbackId = baseIndex + index + 1;
    const primaryGroup = Array.isArray(q.groupCodes) && q.groupCodes.length ? q.groupCodes[0] : undefined;
    const displayId =
      formatQuestionIdentifier(q, { groupCode: primaryGroup, fallback: fallbackId }) ??
      (typeof fallbackId === "number" ? fallbackId : null);
    return (
    <li>
      <a class="question-card card-panel" href={`/questions/${q.slug}`}>
        {showQuestionId && displayId !== null ? (
          <span class="question-id">#{displayId}</span>
        ) : null}
        <span class="question-title">{q.title}</span>
      </a>
    </li>
    );
  })}
</ul>
