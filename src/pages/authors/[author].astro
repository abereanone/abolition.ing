---
import Main from "@/layouts/Main.astro";
import QuestionFeed from "@/components/QuestionFeed.astro";
import { findAuthor, getQuestionsByAuthor, listAuthors } from "@/lib/questions";

export function getStaticPaths() {
  return listAuthors().map((author) => ({
    params: { author: author.id },
  }));
}

const { author } = Astro.params;
const activeAuthor = findAuthor(author);

if (!activeAuthor) {
  throw new Error(`Author not found for slug "${author}".`);
}

const matchingQuestions = getQuestionsByAuthor(activeAuthor.id);
---

<Main title={`${activeAuthor.name} Questions - abolition.ing`}>
  <QuestionFeed
    title={`${activeAuthor.name} Questions`}
    questions={matchingQuestions}
  >
    <fragment slot="header">
      <div class="author-header">
        <a class="breadcrumb" href="/">All questions</a>
        <h1 class="page-title">{activeAuthor.name}</h1>
        {activeAuthor.title ? <p class="author-title">{activeAuthor.title}</p> : null}
        {activeAuthor.bio ? <p class="author-bio">{activeAuthor.bio}</p> : null}
        {activeAuthor.url ? (
          <p class="author-link">
            <a href={activeAuthor.url} target="_blank" rel="noopener noreferrer">
              Visit author website
            </a>
          </p>
        ) : null}
      </div>
    </fragment>
    <fragment slot="empty">
      <p><em>No questions found for this author yet.</em></p>
    </fragment>
  </QuestionFeed>
</Main>
