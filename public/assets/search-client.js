// src/data/search-index.json
var search_index_default = [
  {
    id: 1,
    idLabel: "1",
    slug: "why-is-abortion-wrong",
    title: "Why is abortion wrong?",
    categories: [
      "Moral",
      "Biblical"
    ],
    relatedAnswers: [
      5,
      6,
      12
    ],
    excerpt: "",
    content: "",
    groupCodes: [],
    authorIds: [
      "chatgpt"
    ]
  },
  {
    id: 2,
    idLabel: "2",
    slug: "is-birth-control-ever-biblical",
    title: "Is birth control ever biblical?",
    categories: [
      "Biblical",
      "Moral"
    ],
    relatedAnswers: [
      18,
      21,
      26
    ],
    excerpt: "",
    content: "",
    groupCodes: [],
    authorIds: [
      "chatgpt"
    ]
  },
  {
    id: 3,
    idLabel: "3",
    slug: "what-is-the-difference-between-abolition-and-pro-life",
    title: "What is the difference between abolition and pro-life?",
    categories: [
      "Practical",
      "Moral"
    ],
    relatedAnswers: [
      1,
      5,
      42
    ],
    excerpt: "",
    content: "",
    groupCodes: [],
    authorIds: [
      "mac"
    ]
  },
  {
    id: 4,
    idLabel: "4",
    slug: "how-should-christians-respond-to-rape-and-abortion",
    title: "How should Christians respond to rape and abortion?",
    categories: [
      "Moral",
      "Pastoral"
    ],
    relatedAnswers: [
      40,
      25,
      20
    ],
    excerpt: "",
    content: "",
    groupCodes: [],
    authorIds: [
      "chatgpt"
    ]
  },
  {
    id: 5,
    idLabel: "5",
    slug: "can-abortion-be-forgiven",
    title: "Can abortion be forgiven?",
    categories: [
      "Biblical",
      "Pastoral"
    ],
    relatedAnswers: [
      48,
      3,
      11
    ],
    excerpt: "",
    content: "",
    groupCodes: [],
    authorIds: [
      "chatgpt"
    ]
  },
  {
    id: 6,
    idLabel: "6",
    slug: "what-does-the-bible-say-about-the-value-of-life",
    title: "What does the Bible say about the value of life?",
    categories: [
      "Biblical"
    ],
    relatedAnswers: [
      1,
      10,
      47
    ],
    excerpt: "",
    content: "",
    groupCodes: [],
    authorIds: [
      "chatgpt"
    ]
  },
  {
    id: 7,
    idLabel: "7",
    slug: "should-abortion-be-punished-by-law",
    title: "Should abortion be punished by law?",
    categories: [
      "Moral",
      "Practical"
    ],
    relatedAnswers: [
      41,
      42,
      23
    ],
    excerpt: "",
    content: "",
    groupCodes: [],
    authorIds: [
      "chatgpt"
    ]
  },
  {
    id: 8,
    idLabel: "8",
    slug: "what-about-ectopic-pregnancy",
    title: "What about ectopic pregnancy?",
    categories: [
      "Scientific",
      "Pastoral"
    ],
    relatedAnswers: [
      19,
      20,
      10
    ],
    excerpt: "",
    content: "",
    groupCodes: [],
    authorIds: [
      "chatgpt"
    ]
  },
  {
    id: 9,
    idLabel: "9",
    slug: "how-should-the-church-engage-abortion-culture",
    title: "How should the church engage abortion culture?",
    categories: [
      "Biblical",
      "Practical"
    ],
    relatedAnswers: [
      38,
      15,
      45
    ],
    excerpt: "",
    content: "",
    groupCodes: [],
    authorIds: [
      "chatgpt"
    ]
  },
  {
    id: 10,
    idLabel: "10",
    slug: "does-science-prove-life-begins-at-conception",
    title: "Does science prove life begins at conception?",
    categories: [
      "Scientific",
      "Moral"
    ],
    relatedAnswers: [
      47,
      44,
      24
    ],
    excerpt: "",
    content: "",
    groupCodes: [],
    authorIds: [
      "chatgpt"
    ]
  },
  {
    id: 11,
    idLabel: "11",
    slug: "how-should-we-care-for-post-abortive-women",
    title: "How should we care for post-abortive women?",
    categories: [
      "Pastoral",
      "Practical"
    ],
    relatedAnswers: [
      5,
      34,
      30
    ],
    excerpt: "",
    content: "",
    groupCodes: [],
    authorIds: [
      "chatgpt"
    ]
  },
  {
    id: 12,
    idLabel: "12",
    slug: "is-it-loving-to-call-abortion-murder",
    title: "Is it loving to call abortion murder?",
    categories: [
      "Moral",
      "Biblical"
    ],
    relatedAnswers: [
      1,
      45,
      14
    ],
    excerpt: "",
    content: "",
    groupCodes: [],
    authorIds: [
      "chatgpt"
    ]
  },
  {
    id: 13,
    idLabel: "13",
    slug: "what-about-contraceptives-that-cause-early-abortion",
    title: "What about contraceptives that cause early abortion?",
    categories: [
      "Scientific",
      "Moral"
    ],
    relatedAnswers: [
      2,
      21,
      31
    ],
    excerpt: "",
    content: "",
    groupCodes: [],
    authorIds: [
      "chatgpt"
    ]
  },
  {
    id: 14,
    idLabel: "14",
    slug: "why-should-men-speak-out-against-abortion",
    title: "Why should men speak out against abortion?",
    categories: [
      "Moral",
      "Practical"
    ],
    relatedAnswers: [
      43,
      30,
      22
    ],
    excerpt: "",
    content: "",
    groupCodes: [],
    authorIds: [
      "chatgpt"
    ]
  },
  {
    id: 15,
    idLabel: "15",
    slug: "what-role-should-civil-government-play",
    title: "What role should civil government play in ending abortion?",
    categories: [
      "Biblical",
      "Practical"
    ],
    relatedAnswers: [
      7,
      23,
      41
    ],
    excerpt: "",
    content: "",
    groupCodes: [],
    authorIds: [
      "chatgpt"
    ]
  },
  {
    id: 16,
    idLabel: "16",
    slug: "is-gestational-surrogacy-biblical",
    title: "Is gestational surrogacy consistent with biblical teaching on motherhood?",
    categories: [
      "Biblical",
      "Moral"
    ],
    relatedAnswers: [
      17,
      33,
      27
    ],
    excerpt: "",
    content: "",
    groupCodes: [],
    authorIds: [
      "chatgpt"
    ]
  },
  {
    id: 17,
    idLabel: "17",
    slug: "how-should-christians-view-frozen-embryos",
    title: "How should Christians think about IVF embryos that remain frozen?",
    categories: [
      "Biblical",
      "Moral",
      "Practical"
    ],
    relatedAnswers: [
      16,
      27,
      33
    ],
    excerpt: "",
    content: "",
    groupCodes: [],
    authorIds: [
      "chatgpt"
    ]
  },
  {
    id: 18,
    idLabel: "18",
    slug: "does-scripture-allow-natural-family-planning",
    title: "Does Scripture allow for delaying pregnancy through natural family planning?",
    categories: [
      "Biblical",
      "Practical"
    ],
    relatedAnswers: [
      2,
      21,
      26
    ],
    excerpt: "",
    content: "",
    groupCodes: [],
    authorIds: [
      "chatgpt"
    ]
  },
  {
    id: 19,
    idLabel: "19",
    slug: "what-medical-evidence-distinguishes-ectopic-care-from-abortion",
    title: "What medical evidence shows life-saving care for ectopic pregnancies differs from abortion?",
    categories: [
      "Scientific",
      "Moral",
      "Practical"
    ],
    relatedAnswers: [
      8,
      24,
      37
    ],
    excerpt: "",
    content: "",
    groupCodes: [],
    authorIds: [
      "chatgpt"
    ]
  },
  {
    id: 20,
    idLabel: "20",
    slug: "how-can-churches-support-high-risk-pregnancies",
    title: "How can churches support women with high-risk pregnancies?",
    categories: [
      "Pastoral",
      "Practical"
    ],
    relatedAnswers: [
      8,
      25,
      39
    ],
    excerpt: "",
    content: "",
    groupCodes: [],
    authorIds: [
      "chatgpt"
    ]
  },
  {
    id: 21,
    idLabel: "21",
    slug: "are-hormonal-contraceptives-that-prevent-implantation-moral",
    title: "Are hormonal contraceptives that prevent implantation morally permissible?",
    categories: [
      "Moral",
      "Scientific"
    ],
    relatedAnswers: [
      2,
      13,
      18
    ],
    excerpt: "",
    content: "",
    groupCodes: [],
    authorIds: [
      "chatgpt"
    ]
  },
  {
    id: 22,
    idLabel: "22",
    slug: "what-does-the-bible-teach-about-fatherly-protection",
    title: "What does the Bible teach about fathers protecting preborn children?",
    categories: [
      "Biblical",
      "Pastoral",
      "Practical"
    ],
    relatedAnswers: [
      14,
      43,
      39
    ],
    excerpt: "",
    content: "",
    groupCodes: [],
    authorIds: [
      "chatgpt"
    ]
  },
  {
    id: 23,
    idLabel: "23",
    slug: "should-magistrates-prosecute-abortion-pill-distribution",
    title: "Should civil magistrates prosecute abortion pill distribution?",
    categories: [
      "Biblical",
      "Moral",
      "Practical"
    ],
    relatedAnswers: [
      7,
      32,
      28
    ],
    excerpt: "",
    content: "",
    groupCodes: [],
    authorIds: [
      "chatgpt"
    ]
  },
  {
    id: 24,
    idLabel: "24",
    slug: "what-do-ultrasound-studies-reveal-about-fetal-pain",
    title: "What do ultrasound studies reveal about fetal pain?",
    categories: [
      "Scientific",
      "Moral"
    ],
    relatedAnswers: [
      10,
      44,
      37
    ],
    excerpt: "",
    content: "",
    groupCodes: [],
    authorIds: [
      "chatgpt"
    ]
  },
  {
    id: 25,
    idLabel: "25",
    slug: "how-should-christians-respond-to-prenatal-disability-diagnoses",
    title: "How should Christian couples respond to a prenatal diagnosis of disability?",
    categories: [
      "Biblical",
      "Moral",
      "Pastoral"
    ],
    relatedAnswers: [
      20,
      39,
      28
    ],
    excerpt: "",
    content: "",
    groupCodes: [],
    authorIds: [
      "chatgpt"
    ]
  },
  {
    id: 26,
    idLabel: "26",
    slug: "is-permanent-sterilization-a-faithful-family-planning-choice",
    title: "Is permanent sterilization an acceptable Christian response to family planning?",
    categories: [
      "Biblical",
      "Moral",
      "Practical"
    ],
    relatedAnswers: [
      2,
      18,
      21
    ],
    excerpt: "",
    content: "",
    groupCodes: [],
    authorIds: [
      "chatgpt"
    ]
  },
  {
    id: 27,
    idLabel: "27",
    slug: "how-does-psalm-139-guide-our-view-of-lab-created-embryos",
    title: "How does Psalm 139 inform our view of embryos created in laboratories?",
    categories: [
      "Biblical",
      "Moral"
    ],
    relatedAnswers: [
      16,
      17,
      33
    ],
    excerpt: "",
    content: "",
    groupCodes: [],
    authorIds: [
      "chatgpt"
    ]
  },
  {
    id: 28,
    idLabel: "28",
    slug: "what-protections-do-post-roe-states-provide-for-mothers",
    title: "What protections do post-Roe states provide for mothers?",
    categories: [
      "Moral",
      "Practical"
    ],
    relatedAnswers: [
      32,
      23,
      41
    ],
    excerpt: "",
    content: "",
    groupCodes: [],
    authorIds: [
      "chatgpt"
    ]
  },
  {
    id: 29,
    idLabel: "29",
    slug: "can-christians-participate-in-fetal-tissue-research",
    title: "Can Christians participate in fetal tissue research?",
    categories: [
      "Biblical",
      "Moral",
      "Scientific"
    ],
    relatedAnswers: [
      17,
      33,
      35
    ],
    excerpt: "",
    content: "",
    groupCodes: [],
    authorIds: [
      "chatgpt"
    ]
  },
  {
    id: 30,
    idLabel: "30",
    slug: "what-is-the-churchs-role-in-post-abortion-discipleship-for-men",
    title: "What is the church's role in post-abortion discipleship for men?",
    categories: [
      "Pastoral",
      "Practical"
    ],
    relatedAnswers: [
      11,
      14,
      43
    ],
    excerpt: "",
    content: "",
    groupCodes: [],
    authorIds: [
      "chatgpt"
    ]
  },
  {
    id: 31,
    idLabel: "31",
    slug: "does-emergency-contraception-act-as-an-abortifacient",
    title: "Does emergency contraception act as an abortifacient?",
    categories: [
      "Scientific",
      "Moral"
    ],
    relatedAnswers: [
      13,
      21,
      2
    ],
    excerpt: "",
    content: "",
    groupCodes: [],
    authorIds: [
      "chatgpt"
    ]
  },
  {
    id: 32,
    idLabel: "32",
    slug: "how-should-lawmakers-respond-to-abortion-tourism",
    title: "How should lawmakers respond to abortion tourism?",
    categories: [
      "Moral",
      "Practical"
    ],
    relatedAnswers: [
      28,
      23,
      41
    ],
    excerpt: "",
    content: "",
    groupCodes: [],
    authorIds: [
      "chatgpt"
    ]
  },
  {
    id: 33,
    idLabel: "33",
    slug: "what-are-ethical-alternatives-to-ivf",
    title: "What are ethical alternatives to IVF for infertile couples?",
    categories: [
      "Biblical",
      "Moral",
      "Practical"
    ],
    relatedAnswers: [
      16,
      17,
      27
    ],
    excerpt: "",
    content: "",
    groupCodes: [],
    authorIds: [
      "chatgpt"
    ]
  },
  {
    id: 34,
    idLabel: "34",
    slug: "how-can-pastors-counsel-survivors-of-coerced-abortion",
    title: "How can pastors counsel survivors of coerced abortion?",
    categories: [
      "Pastoral",
      "Moral"
    ],
    relatedAnswers: [
      11,
      30,
      43
    ],
    excerpt: "",
    content: "",
    groupCodes: [],
    authorIds: [
      "chatgpt"
    ]
  },
  {
    id: 35,
    idLabel: "35",
    slug: "what-does-church-history-teach-about-abortion",
    title: "What does church history teach about abortion in the early centuries?",
    categories: [
      "Biblical",
      "Moral",
      "Practical"
    ],
    relatedAnswers: [
      1,
      12,
      38
    ],
    excerpt: "",
    content: "",
    groupCodes: [],
    authorIds: [
      "chatgpt"
    ]
  },
  {
    id: 36,
    idLabel: "36",
    slug: "should-christians-support-fetal-heartbeat-legislation",
    title: "Should Christians support fetal heartbeat legislation?",
    categories: [
      "Biblical",
      "Moral",
      "Practical"
    ],
    relatedAnswers: [
      42,
      44,
      41
    ],
    excerpt: "",
    content: "",
    groupCodes: [],
    authorIds: [
      "chatgpt"
    ]
  },
  {
    id: 37,
    idLabel: "37",
    slug: "how-do-chemical-abortions-impact-womens-health",
    title: "How do chemical abortions impact women's health?",
    categories: [
      "Scientific",
      "Moral"
    ],
    relatedAnswers: [
      45,
      31,
      24
    ],
    excerpt: "",
    content: "",
    groupCodes: [],
    authorIds: [
      "chatgpt"
    ]
  },
  {
    id: 38,
    idLabel: "38",
    slug: "what-does-proverbs-teach-about-rescuing-the-preborn",
    title: "What does Proverbs teach about rescuing preborn neighbors?",
    categories: [
      "Biblical",
      "Moral",
      "Practical"
    ],
    relatedAnswers: [
      9,
      22,
      1
    ],
    excerpt: "",
    content: "",
    groupCodes: [],
    authorIds: [
      "chatgpt"
    ]
  },
  {
    id: 39,
    idLabel: "39",
    slug: "how-can-deacons-organize-mercy-ministry-for-single-mothers",
    title: "How can deacons organize mercy ministry for single mothers?",
    categories: [
      "Pastoral",
      "Practical"
    ],
    relatedAnswers: [
      20,
      11,
      30
    ],
    excerpt: "",
    content: "",
    groupCodes: [],
    authorIds: [
      "chatgpt"
    ]
  },
  {
    id: 40,
    idLabel: "40",
    slug: "what-scriptures-address-children-conceived-in-rape",
    title: "What scriptures address the value of children conceived in rape?",
    categories: [
      "Biblical",
      "Moral",
      "Pastoral"
    ],
    relatedAnswers: [
      4,
      25,
      5
    ],
    excerpt: "",
    content: "",
    groupCodes: [],
    authorIds: [
      "chatgpt"
    ]
  },
  {
    id: 41,
    idLabel: "41",
    slug: "what-legal-strategies-end-abortion-without-exceptions",
    title: "What legal strategies end abortion without exceptions?",
    categories: [
      "Moral",
      "Practical"
    ],
    relatedAnswers: [
      7,
      42,
      23
    ],
    excerpt: "",
    content: "",
    groupCodes: [],
    authorIds: [
      "chatgpt"
    ]
  },
  {
    id: 42,
    idLabel: "42",
    slug: "how-can-christians-discern-compromised-prolife-legislation",
    title: "How can Christians discern pro-life legislation that compromises justice?",
    categories: [
      "Biblical",
      "Moral",
      "Practical"
    ],
    relatedAnswers: [
      7,
      36,
      41
    ],
    excerpt: "",
    content: "",
    groupCodes: [],
    authorIds: [
      "chatgpt"
    ]
  },
  {
    id: 43,
    idLabel: "43",
    slug: "what-steps-should-fathers-take-when-mothers-consider-abortion",
    title: "What steps should fathers take when mothers consider abortion?",
    categories: [
      "Pastoral",
      "Moral",
      "Practical"
    ],
    relatedAnswers: [
      14,
      22,
      30
    ],
    excerpt: "",
    content: "",
    groupCodes: [],
    authorIds: [
      "chatgpt"
    ]
  },
  {
    id: 44,
    idLabel: "44",
    slug: "does-a-detectable-heartbeat-prove-personhood",
    title: "Does a detectable heartbeat prove personhood scientifically and biblically?",
    categories: [
      "Scientific",
      "Biblical",
      "Moral"
    ],
    relatedAnswers: [
      10,
      36,
      24
    ],
    excerpt: "",
    content: "",
    groupCodes: [],
    authorIds: [
      "chatgpt"
    ]
  },
  {
    id: 45,
    idLabel: "45",
    slug: "how-do-we-answer-claims-that-abortion-is-healthcare",
    title: "How do we answer claims that abortion is healthcare?",
    categories: [
      "Scientific",
      "Moral",
      "Practical"
    ],
    relatedAnswers: [
      1,
      37,
      9
    ],
    excerpt: "",
    content: "",
    groupCodes: [],
    authorIds: [
      "chatgpt"
    ]
  },
  {
    id: 46,
    idLabel: "46",
    slug: "if-infants-that-die-go-to-heaven-why-is-abortion-a-problem",
    title: "If infants that die go to Heaven, why is abortion a problem?",
    categories: [
      "Biblical",
      "Moral",
      "Practical"
    ],
    relatedAnswers: [
      5,
      1,
      47
    ],
    excerpt: "",
    content: "",
    groupCodes: [],
    authorIds: [
      "mac"
    ]
  },
  {
    id: 47,
    idLabel: "47",
    slug: "when-does-human-life-begin",
    title: "When does human life begin?",
    categories: [
      "Biblical",
      "Scientific"
    ],
    relatedAnswers: [
      10,
      6,
      44
    ],
    excerpt: "",
    content: "",
    groupCodes: [],
    authorIds: [
      "jay"
    ]
  },
  {
    id: 48,
    idLabel: "48",
    slug: "if-abortion-can-be-forgiven",
    title: "If abortion can be forgiven, why not do it and just ask for forgiveness after?",
    categories: [
      "Biblical",
      "Moral"
    ],
    relatedAnswers: [
      5,
      11
    ],
    excerpt: "",
    content: "",
    groupCodes: [],
    authorIds: [
      "mac"
    ]
  }
];

// src/lib/search-engine.js
var STOP_WORDS = /* @__PURE__ */ new Set([
  "a",
  "an",
  "and",
  "are",
  "as",
  "at",
  "be",
  "but",
  "by",
  "for",
  "if",
  "in",
  "into",
  "is",
  "it",
  "no",
  "not",
  "of",
  "on",
  "or",
  "such",
  "that",
  "the",
  "their",
  "then",
  "there",
  "these",
  "they",
  "this",
  "what",
  "to",
  "was",
  "will",
  "with"
]);
var MIN_TOKEN_LENGTH = 3;
function createSearchEngine(dataset = []) {
  const documents = /* @__PURE__ */ new Map();
  const invertedIndex = /* @__PURE__ */ new Map();
  dataset.forEach((doc, position) => {
    const docId = doc && doc.id != null ? String(doc.id) : `${doc.slug ?? "doc"}-${position}`;
    const normalizedTitle = normalizeText(doc?.title ?? "");
    const normalizedContent = normalizeText(doc?.content ?? "");
    const normalizedCategories = (doc?.categories ?? []).map((category) => normalizeText(category));
    const tokenWeights = /* @__PURE__ */ new Map();
    accumulateTokens(tokenWeights, doc?.title ?? "", 3);
    accumulateTokens(tokenWeights, doc?.content ?? "", 1);
    accumulateTokens(tokenWeights, (doc?.categories ?? []).join(" "), 2);
    const tokenCount = Array.from(tokenWeights.values()).reduce((sum, value) => sum + value, 0) || 1;
    const record = {
      ...doc,
      docId,
      normalizedTitle,
      normalizedContent,
      normalizedCategories,
      tokenCount
    };
    documents.set(docId, record);
    tokenWeights.forEach((weight, token) => {
      if (!invertedIndex.has(token)) {
        invertedIndex.set(token, []);
      }
      invertedIndex.get(token).push({ docId, weight });
    });
  });
  return { documents, invertedIndex };
}
function searchIndex(engine2, query, options = {}) {
  if (!engine2) {
    return { total: 0, items: [] };
  }
  const tokens = tokenize(query).filter((token) => token.length >= MIN_TOKEN_LENGTH && !STOP_WORDS.has(token));
  const uniqueTokens = [...new Set(tokens)];
  const docScores = /* @__PURE__ */ new Map();
  uniqueTokens.forEach((token) => {
    const entries = engine2.invertedIndex.get(token);
    if (!entries) return;
    entries.forEach(({ docId, weight }) => {
      const doc = engine2.documents.get(docId);
      if (!doc) return;
      const score = docScores.get(docId) ?? 0;
      docScores.set(docId, score + weight / doc.tokenCount);
    });
  });
  if (!docScores.size && uniqueTokens.length === 1) {
    const fallback = uniqueTokens[0];
    engine2.documents.forEach((doc, docId) => {
      if (doc.normalizedTitle.includes(fallback) || doc.normalizedContent.includes(fallback)) {
        docScores.set(docId, 0.05);
      }
    });
  }
  const filters = (options.categories ?? []).map((category) => normalizeText(category));
  const authorFilters = (options.authors ?? []).map((author) => String(author).toLowerCase());
  const normalizedQuery = normalizeText(query);
  if (!docScores.size && !uniqueTokens.length && !normalizedQuery) {
    engine2.documents.forEach((doc, docId) => {
      docScores.set(docId, 0);
    });
  }
  const ranked = Array.from(docScores.entries()).map(([docId, score]) => {
    const doc = engine2.documents.get(docId);
    if (!doc) {
      return null;
    }
    let adjusted = score;
    if (normalizedQuery && doc.normalizedTitle.includes(normalizedQuery)) {
      adjusted += 1.5;
    } else if (normalizedQuery && doc.normalizedContent.includes(normalizedQuery)) {
      adjusted += 0.5;
    }
    if (doc.relatedAnswers?.length) {
      adjusted += Math.min(0.4, doc.relatedAnswers.length * 0.05);
    }
    return { doc, score: adjusted };
  }).filter(Boolean);
  const filtered = ranked.filter(({ doc }) => {
    if (filters.length && !filters.every((target) => doc.normalizedCategories.includes(target))) {
      return false;
    }
    if (authorFilters.length) {
      const docAuthors = (doc.authorIds ?? []).map((id) => String(id).toLowerCase());
      return authorFilters.every((author) => docAuthors.includes(author));
    }
    return true;
  });
  filtered.sort((a, b) => {
    if (b.score !== a.score) {
      return b.score - a.score;
    }
    return a.doc.title.localeCompare(b.doc.title);
  });
  const limit = options.limit ?? 10;
  const limited = filtered.slice(0, limit);
  const highlightTokens = filterHighlightTokens(
    uniqueTokens.length ? uniqueTokens : normalizedQuery && normalizedQuery.length >= MIN_TOKEN_LENGTH ? [normalizedQuery] : []
  );
  return {
    total: filtered.length,
    items: limited.map(({ doc, score }) => ({
      id: doc.id,
      idLabel: doc.idLabel ?? null,
      slug: doc.slug,
      title: doc.title,
      highlightedTitle: highlightText(doc.title ?? "", highlightTokens),
      categories: doc.categories,
      excerpt: doc.excerpt,
      snippet: buildSnippet(doc, highlightTokens) || doc.excerpt,
      relatedAnswers: doc.relatedAnswers,
      score: Number(score.toFixed(4)),
      url: `/questions/${doc.slug}`
    }))
  };
}
function accumulateTokens(target, text, weightMultiplier) {
  tokenize(text).forEach((token) => {
    if (!token) return;
    const current = target.get(token) ?? 0;
    target.set(token, current + weightMultiplier);
  });
}
function tokenize(value) {
  return normalizeText(value).split(/\s+/).map((token) => token.trim()).filter(Boolean);
}
function normalizeText(value) {
  return (value ?? "").toLowerCase().normalize("NFKD").replace(/[\u0300-\u036f]/g, "").replace(/[^a-z0-9\s]/g, " ").replace(/\s+/g, " ").trim();
}
function buildSnippet(doc, tokens) {
  if (!doc.content) {
    return doc.excerpt ?? "";
  }
  if (!tokens.length) {
    return doc.excerpt ?? doc.content.slice(0, 160);
  }
  const loweredContent = doc.content.toLowerCase();
  let matchIndex = -1;
  let matchLength = 0;
  for (const token of tokens) {
    const index = loweredContent.indexOf(token.toLowerCase());
    if (index !== -1) {
      matchIndex = index;
      matchLength = token.length;
      break;
    }
  }
  if (matchIndex === -1) {
    return doc.excerpt ?? doc.content.slice(0, 160);
  }
  const start = Math.max(0, matchIndex - 80);
  const end = Math.min(doc.content.length, matchIndex + matchLength + 80);
  let snippet = doc.content.slice(start, end).trim();
  const highlightPattern = new RegExp(tokens.map(escapeRegExp).join("|"), "gi");
  snippet = snippet.replace(highlightPattern, (match) => `<mark>${match}</mark>`);
  if (start > 0) {
    snippet = `\u2026${snippet}`;
  }
  if (end < doc.content.length) {
    snippet = `${snippet}\u2026`;
  }
  return snippet;
}
function escapeRegExp(value) {
  return value.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
}
function highlightText(text, tokens) {
  if (!text || !tokens.length) {
    return text ?? "";
  }
  const pattern = new RegExp(tokens.map(escapeRegExp).join("|"), "gi");
  return text.replace(pattern, (match) => `<mark>${match}</mark>`);
}
function filterHighlightTokens(tokens) {
  return tokens.filter((token) => token.length >= MIN_TOKEN_LENGTH);
}

// src/scripts/search-page.ts
var engine = createSearchEngine(Array.isArray(search_index_default) ? search_index_default : []);
var initialized = false;
var MIN_QUERY_LENGTH = 3;
function initSearchPage() {
  if (initialized || typeof document === "undefined") {
    return;
  }
  initialized = true;
  const start = () => {
    const root = document.querySelector("[data-search-root]");
    if (!root) return;
    const showQuestionIds = root.dataset.showQuestionIds === "true";
    const form = root.querySelector("#search-form");
    const input = root.querySelector("#search-input");
    const metaContainer = root.querySelector("#search-meta");
    const resultsContainer = root.querySelector("#search-results");
    const authorFilter = root.querySelector("[data-author-filter]");
    if (!form || !input || !metaContainer || !resultsContainer) {
      return;
    }
    const params = new URLSearchParams(window.location.search);
    const initialQuery = params.get("q") ?? "";
    let selectedAuthor = params.get("author") || "";
    const authorMapRaw = root.dataset.authorMap;
    const authorLookup = {};
    if (authorMapRaw) {
      try {
        const parsed = JSON.parse(authorMapRaw);
        if (Array.isArray(parsed)) {
          parsed.forEach((entry) => {
            if (entry && typeof entry.id === "string") {
              authorLookup[entry.id] = entry.name ?? entry.id;
            }
          });
        }
      } catch (error) {
        console.warn("Unable to parse author map for search filters.", error);
      }
    }
    if (initialQuery) {
      input.value = initialQuery;
      performSearch(initialQuery);
    }
    focusSearchInput();
    let debounceTimer = null;
    form.addEventListener("submit", (event) => {
      event.preventDefault();
      const query = input.value.trim();
      const normalized = normalizeQueryValue(query);
      updateUrlState(normalized);
      performSearch(normalized);
    });
    input.addEventListener("input", () => {
      if (debounceTimer) {
        window.clearTimeout(debounceTimer);
      }
      debounceTimer = window.setTimeout(() => {
        const query = input.value.trim();
        const normalized = normalizeQueryValue(query);
        updateUrlState(normalized);
        performSearch(normalized);
      }, 300);
    });
    if (authorFilter) {
      authorFilter.addEventListener("click", (event) => {
        const target = event.target;
        if (!target || !target.closest("[data-author]")) {
          return;
        }
        const authorId = target.dataset.author ?? "";
        if (authorId === selectedAuthor) {
          selectedAuthor = "";
        } else {
          selectedAuthor = authorId;
        }
        updateAuthorButtons(authorFilter, selectedAuthor);
        applyUrlState(input.value.trim(), selectedAuthor);
        performSearch(input.value.trim());
      });
      updateAuthorButtons(authorFilter, selectedAuthor);
      if (selectedAuthor && !initialQuery) {
        performSearch("");
      }
    }
    function updateUrlState(query) {
      applyUrlState(query, selectedAuthor);
    }
    function focusSearchInput() {
      if (typeof input.focus === "function") {
        requestAnimationFrame(() => {
          input.focus({ preventScroll: true });
        });
      }
    }
    function performSearch(query) {
      const normalizedQuery = normalizeQueryValue(query);
      const hasQuery = Boolean(normalizedQuery);
      const hasAuthor = Boolean(selectedAuthor);
      if (!hasQuery && !hasAuthor) {
        metaContainer.textContent = "Type a phrase or select an author to begin searching.";
        resultsContainer.innerHTML = "";
        return;
      }
      if (hasQuery && normalizedQuery.length < MIN_QUERY_LENGTH) {
        metaContainer.textContent = "Please enter at least 3 characters to search.";
        resultsContainer.innerHTML = "";
        return;
      }
      metaContainer.textContent = "Searching...";
      const payload = searchIndex(engine, normalizedQuery, {
        limit: 25,
        authors: selectedAuthor ? [selectedAuthor] : void 0
      });
      const { items, total } = payload;
      const authorName = selectedAuthor ? authorLookup[selectedAuthor] ?? selectedAuthor : null;
      const filterLabel = buildFilterLabel(hasQuery ? normalizedQuery : "", authorName);
      if (!items.length) {
        metaContainer.textContent = filterLabel ? `No results found for ${filterLabel}.` : "No results found.";
        resultsContainer.innerHTML = "";
        return;
      }
      const resultCount = total === items.length ? total : `${items.length} of ${total}`;
      metaContainer.textContent = filterLabel ? `Showing ${resultCount} results for ${filterLabel}.` : `Showing ${resultCount} results.`;
      resultsContainer.innerHTML = items.map((result) => {
        const titleHtml = result.highlightedTitle || result.title;
        const snippetHtml = result.snippet || result.excerpt || "";
        const idLabel = result.idLabel ?? (result.id !== null && result.id !== void 0 ? String(result.id) : null);
        const titlePrefix = showQuestionIds && idLabel ? `<span class="result-id">#${idLabel}</span> ` : "";
        return `
            <article class="search-result">
              <h2><a href="${result.url}">${titlePrefix}${titleHtml}</a></h2>
              <p class="result-snippet">${snippetHtml}</p>
            </article>
          `;
      }).join("");
    }
  };
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", start, { once: true });
  } else {
    start();
  }
}
if (typeof document !== "undefined") {
  initSearchPage();
}
function normalizeQueryValue(value) {
  return value.trim();
}
function updateAuthorButtons(container, selected) {
  const buttons = Array.from(container.querySelectorAll("[data-author]"));
  buttons.forEach((button) => {
    const id = button.dataset.author ?? "";
    if (id === selected) {
      button.classList.add("is-active");
      button.setAttribute("aria-pressed", "true");
    } else {
      button.classList.remove("is-active");
      button.setAttribute("aria-pressed", "false");
    }
  });
}
function applyUrlState(rawQuery, author) {
  const query = normalizeQueryValue(rawQuery);
  const searchParams = new URLSearchParams(window.location.search);
  if (query) {
    searchParams.set("q", query);
  } else {
    searchParams.delete("q");
  }
  if (author) {
    searchParams.set("author", author);
  } else {
    searchParams.delete("author");
  }
  const next = `${window.location.pathname}${searchParams.toString() ? `?${searchParams}` : ""}`;
  window.history.replaceState({}, "", next);
}
function buildFilterLabel(query, authorName) {
  if (query && authorName) {
    return `"${query}" and author: ${authorName}`;
  }
  if (query) {
    return `"${query}"`;
  }
  if (authorName) {
    return `author: ${authorName}`;
  }
  return "";
}
export {
  initSearchPage
};
